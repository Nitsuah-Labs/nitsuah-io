#!/bin/sh
# Add Node.js to PATH for Git Bash on Windows
export PATH="/c/Program Files/nodejs:$PATH"

echo "üîç Running pre-commit validation (fast checks with auto-fix)..."

# Step 1: Type checking
echo "1/4 Checking types..."
npm run typecheck || exit 1

# Step 2: Linting (next lint doesn't support --fix, auto-fix happens in lint-staged)
echo "2/4 Running linter..."
npm run lint || {
	echo "‚ö†Ô∏è  Lint errors found. They will be auto-fixed in the next step if possible."
}

# Step 3: Auto-formatting and auto-fixing staged files
echo "3/4 Auto-formatting and auto-fixing staged files..."
npx lint-staged || {
	echo "npx lint-staged failed or unavailable; falling back to project formatter..."
	npm run format || exit 1
	git add -A
}

# Step 4: Jest unit tests
echo "4/4 Running Jest tests..."
npm test || {
	echo "‚ö†Ô∏è  Tests failed. Please fix them before committing."
	exit 1
}

echo "‚úÖ All pre-commit checks passed! (accessibility tests will run on push)"


