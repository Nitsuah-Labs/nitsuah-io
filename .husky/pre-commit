#!/bin/sh
# Add Node.js to PATH for Git Bash on Windows
export PATH="/c/Program Files/nodejs:$PATH"

echo "üîç Running pre-commit validation (fast checks with auto-fix)..."

# Step 1: Lint with auto-fix FIRST (catches and fixes issues early)
echo "1/4 Linting with auto-fix..."
npm run lint:fix || {
	echo "‚ö†Ô∏è  Linting found issues that couldn't be auto-fixed"
	exit 1
}

# Step 2: Type checking
echo "2/4 Checking types..."
npm run typecheck || exit 1

# Step 3: Auto-formatting staged files
echo "3/4 Auto-formatting staged files..."
npx lint-staged || {
	echo "npx lint-staged failed or unavailable; falling back to project formatter..."
	npm run format || exit 1
	git add -A
}

# Step 4: Jest unit tests
echo "4/4 Running Jest tests..."
npm test || exit 1

echo "‚úÖ All pre-commit checks passed! (accessibility tests will run on push)"


